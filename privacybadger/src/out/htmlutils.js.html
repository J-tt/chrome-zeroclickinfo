<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: htmlutils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: htmlutils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * This file is part of Privacy Badger &lt;https://www.eff.org/privacybadger>
 * Copyright (C) 2014 Electronic Frontier Foundation
 *
 * Privacy Badger is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 3 as
 * published by the Free Software Foundation.
 *
 * Privacy Badger is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with Privacy Badger.  If not, see &lt;http://www.gnu.org/licenses/>.
 */

var i18n = chrome.i18n;

require.scopes.htmlutils = (function() {

var constants = chrome.extension.getBackgroundPage().constants;

// Ugly HTML helpers.
// TODO: Some or all of these should be replace but have been moved here to
// eliminate code duplication elsewhere.
var exports = {};
var htmlUtils = exports.htmlUtils = {

  /**
   * Trims a given string to a given length if necessary.
   *
   * @param {String} inputString String to trim.
   * @param {Integer} maxLength Length to trim inputString to.
   * @returns {String} Trimmed string.
   */
  trim: function(inputString, maxLength) {
    if (inputString.length > maxLength) {
      return inputString.slice(0, maxLength - 3) + '...';
    } else {
      return inputString;
    }
  },

  /**
   * Determines if radio input is checked based on origin's action.
   *
   * @param {String} inputAction Action of current radio input.
   * @param {String} originAction Action of current origin.
   * @returns {String} 'checked' if both actions match otherwise empty string.
   */
  isChecked: function(inputAction, originAction) {
    if(originAction == constants.NO_TRACKING) { originAction = constants.ALLOW; }
    return (inputAction === originAction) ? 'checked' : '';
  },

  /**
   * Gets localized description for given action and origin.
   *
   * @param {String} action The action to get description for.
   * @param {String} origin The origin to get description for.
   * @returns {String} Localized action description with origin.
   */
  getActionDescription: function(action, origin) {
    var actionDescriptions = {
      block: i18n.getMessage('badger_status_block'),
      cookieblock: i18n.getMessage('badger_status_cookieblock'),
      noaction: "No tracking for ",
      allow: i18n.getMessage('badger_status_noaction'),
    };
    return actionDescriptions[action] + origin;
  },

  /**
   * Gets HTML for origin action toggle switch (block, block cookies, allow).
   *
   * @param {String} origin Origin to get toggle for.
   * @param {String} action Current action of given origin.
   * @returns {String} HTML for toggle switch.
   */
  getToggleHtml: function(origin, action) {
    var originId = origin.replace(/\./g, '-');
    var toggleHtml = '' +
      '&lt;div class="switch-container ' + action + '">' +
      '&lt;div class="switch-toggle switch-3 switch-candy">' +
      '&lt;input id="block-' + originId + '" name="' + origin + '" value="0" type="radio" ' + htmlUtils.isChecked('block', action) + '>&lt;label tooltip="click here to block this tracker entirely" class="actionToggle" for="block-' + originId + '" data-origin="' + origin + '" data-action="block">&lt;/label>' +
      '&lt;input id="cookieblock-' + originId + '" name="' + origin + '" value="1" type="radio" ' + htmlUtils.isChecked('cookieblock', action) + '>&lt;label tooltip="click here to block this tracker from setting cookies" class="actionToggle" for="cookieblock-' + originId + '" data-origin="' + origin + '" data-action="cookieblock">&lt;/label>' +
      '&lt;input id="allow-' + originId + '" name="' + origin + '" value="2" type="radio" ' + htmlUtils.isChecked('allow', action) + '>&lt;label tooltip="click here to allow this tracker" class="actionToggle" for="allow-' + originId + '" data-origin="' + origin + '" data-action="allow">&lt;/label>' +
      '&lt;a>&lt;img src="/icons/badger-slider-handle.png">&lt;/a>&lt;/div>&lt;/div>';
    return toggleHtml;
  },

  /**
   * Get HTML for tracker container.
   *
   * @param {Integer} tabId ID of tab trackers are associated with.
   * @returns {String} HTML for empty tracker container.
   */
  getTrackerContainerHtml: function(tabId) {
    if (tabId === undefined) {
      tabId = "000";
    }
    var trackerHtml = '' +
      '&lt;div id="associatedTab" data-tab-id="' + tabId + '">&lt;/div>' +
      '&lt;div class="keyContainer">' +
      '&lt;div class="key">' +
      '&lt;img class="tooltip" src="/icons/UI-icons-red.svg" tooltip="' + i18n.getMessage("tooltip_block") + '">' +
      '&lt;img class="tooltip" src="/icons/UI-icons-yellow.svg" tooltip="' + i18n.getMessage("tooltip_cookieblock") + '">' +
      '&lt;img class="tooltip" src="/icons/UI-icons-green.svg" tooltip="' + i18n.getMessage("tooltip_allow") + '">' +
      '&lt;div class="tooltipContainer">&lt;/div>' +
      '&lt;/div>&lt;/div>' +
      '&lt;div class="spacer">&lt;/div>' +
      '&lt;div id="blockedResourcesInner" class="clickerContainer">&lt;/div>';
    return trackerHtml;
  },

  /**
   * Adds HTML for given origin to existing HTML.
   *
   * @param {String} existingHtml Existing HTML to append origin HTML to.
   * @param {String} origin Origin to get HTML for.
   * @param {String} action Action for given origin.
   * @param {Boolean} isWhitelisted Whether origin is whitelisted or not.
   * @param {Integer} subdomainCount Number of subdomains for given origin.
   * @returns {String} Existing HTML with origin HTML appended.
   */
  addOriginHtml: function(existingHtml, origin, action, isWhitelisted, subdomainCount) {
    // Get classes for main div and tooltip text for inner div.
    var tooltipText = '';
    var classes = ['clicker', 'tooltip'];
    action = _.escape(action);
    origin = _.escape(origin);
    if (action.indexOf('user') === 0) {
      tooltipText = i18n.getMessage('feed_the_badger_title');
      classes.push('userset');
      action = action.substr(5);
    }
    if (action === constants.BLOCK || action === constants.COOKIEBLOCK || action === constants.ALLOW || action === constants.NO_TRACKING) {
      classes.push(action);
    }
    var classText = 'class="' + classes.join(' ') + '"';

    // If origin has been whitelisted set text for DNT.
    var whitelistedText = '';
    if (isWhitelisted) {
      whitelistedText = '' +
        '&lt;div id="dnt-compliant">' +
        '&lt;a target=_blank href="https://www.eff.org/privacybadger#faq--I-am-an-online-advertising-/-tracking-company.--How-do-I-stop-Privacy-Badger-from-blocking-me?">' +
        '&lt;img src="/icons/dnt-16.png" title="This domain promises not to track you.">&lt;/a>&lt;/div>';
    }

    // If there are multiple subdomains set text showing count.
    var subdomainText = '';
    if (subdomainCount) {
      subdomainText = ' (' + subdomainCount + ' subdomains)';
    }

    // Construct HTML for origin.
    var actionDescription = htmlUtils.getActionDescription(action, origin);
    var originHtml = '' +
      '&lt;div ' + classText + ' data-origin="' + origin + '" tooltip="' + actionDescription + '" data-original-action="' + action + '">' +
      '&lt;div class="origin">' + whitelistedText + htmlUtils.trim(origin + subdomainText, 30) + '&lt;/div>' +
      '&lt;div class="removeOrigin">&amp;#10006&lt;/div>' +
      htmlUtils.getToggleHtml(origin, action) +
      '&lt;div class="honeybadgerPowered tooltip" tooltip="'+ tooltipText + '">&lt;/div>' +
      '&lt;img class="tooltipArrow" src="/icons/badger-tb-arrow.png">' +
      '&lt;div class="clear">&lt;/div>' +
      '&lt;div class="tooltipContainer">&lt;/div>' +
      '&lt;/div>';

    return existingHtml + originHtml;
  },
  /**
  * Toggle the GUI blocked status of GUI element(s)
  *
  * @param {String} elt Identify the object(s) to manipulate
  * @param {String} status New status to set, optional
  */
  toggleBlockedStatus: function (elt,status) {
    console.log('toggle blocked status', elt, status);
    if(status){
      elt.removeClass([constants.BLOCK, constants.COOKIEBLOCK, constants.ALLOW, constants.NO_TRACKING].join(" ")).addClass(status);
      elt.addClass("userset");
      return;
    }

    var originalAction = elt.getAttribute('data-original-action');
    if (elt.hasClass(constants.BLOCK)) {
      elt.toggleClass(constants.BLOCK);
    } else if (elt.hasClass(constants.COOKIEBLOCK)) {
      elt.toggleClass(constants.BLOCK);
      elt.toggleClass(constants.COOKIEBLOCK);
    } else {
      elt.toggleClass(constants.COOKIEBLOCK);
    }
    if (elt.hasClass(originalAction) || (originalAction == constants.ALLOW &amp;&amp; !(elt.hasClass(constants.BLOCK) ||
                                                                              elt.hasClass(constants.COOKIEBLOCK)))) {
      elt.removeClass("userset");
    } else {
      elt.addClass("userset");
    }
  },

  /**
  * Compare 2 domains. Reversing them to start comparing the least significant parts (TLD) first
  *
  * @param a First domain
  * @param b Second domain
  * @returns {number} standard compare returns
  */
  compareReversedDomains: function(a, b){
    var fqdn1 = htmlUtils.makeSortable(a);
    var fqdn2 = htmlUtils.makeSortable(b);
    if(fqdn1 &lt; fqdn2){
      return -1;
    }
    if(fqdn1 > fqdn2){
      return 1;
    }
    return 0;
  },

  /**
  * Reverse order of domain items to have the least exact (TLD) first)
  *
  * @param {String} domain The domain to shuffle
  * @returns {String} The 'reversed' domain
  */
  makeSortable: function(domain){
    var tmp = domain.split('.').reverse();
    tmp.shift();
    return tmp.join('');
  },

  /**
  * Get the action class from the element
  *
  * @param elt Element
  * @returns {String} block/cookieblock/noaction
  */
  getCurrentClass: function(elt) {
    if (elt.hasClass(constants.BLOCK)) {
      return constants.BLOCK;
    } else if (elt.hasClass(constants.COOKIEBLOCK)) {
      return constants.COOKIEBLOCK;
    } else if (elt.hasClass(constants.ALLOW)) {
      return constants.ALLOW;
    } else {
      return constants.NO_TRACKING;
    }
  },

};

return exports;

})();
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#active_site">active_site</a></li><li><a href="global.html#addOrigins">addOrigins</a></li><li><a href="global.html#adjustNoInitialBlockingLink">adjustNoInitialBlockingLink</a></li><li><a href="global.html#Badger">Badger</a></li><li><a href="global.html#buildSettingsDict">buildSettingsDict</a></li><li><a href="global.html#closeOverlay">closeOverlay</a></li><li><a href="global.html#CONTENT_SCRIPT_STYLESHEET_PATH">CONTENT_SCRIPT_STYLESHEET_PATH</a></li><li><a href="global.html#createReplacementButtonImage">createReplacementButtonImage</a></li><li><a href="global.html#deactive_site">deactive_site</a></li><li><a href="global.html#displayTooltip">displayTooltip</a></li><li><a href="global.html#event_id">event_id</a></li><li><a href="global.html#exportUserData">exportUserData</a></li><li><a href="global.html#filterTrackingDomains">filterTrackingDomains</a></li><li><a href="global.html#getOriginAction">getOriginAction</a></li><li><a href="global.html#getOrigins">getOrigins</a></li><li><a href="global.html#getOriginsArray">getOriginsArray</a></li><li><a href="global.html#getReplacementButtonUrl">getReplacementButtonUrl</a></li><li><a href="global.html#getScPageScript">getScPageScript</a></li><li><a href="global.html#getStylesheetLinkElement">getStylesheetLinkElement</a></li><li><a href="global.html#getTab">getTab</a></li><li><a href="global.html#getTopLevel">getTopLevel</a></li><li><a href="global.html#getTrackerData">getTrackerData</a></li><li><a href="global.html#hideNoInitialBlockingLink">hideNoInitialBlockingLink</a></li><li><a href="global.html#hideTooltip">hideTooltip</a></li><li><a href="global.html#importTrackerList">importTrackerList</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#insertCcScript">insertCcScript</a></li><li><a href="global.html#insertClsScript">insertClsScript</a></li><li><a href="global.html#insertFpScript">insertFpScript</a></li><li><a href="global.html#insertScScript">insertScScript</a></li><li><a href="global.html#loadFileChooser">loadFileChooser</a></li><li><a href="global.html#parseUserDataFile">parseUserDataFile</a></li><li><a href="global.html#refreshFilterPage">refreshFilterPage</a></li><li><a href="global.html#refreshOriginCache">refreshOriginCache</a></li><li><a href="global.html#refreshPopup">refreshPopup</a></li><li><a href="global.html#registerToggleHandlers">registerToggleHandlers</a></li><li><a href="global.html#removeOrigin">removeOrigin</a></li><li><a href="global.html#replaceButtonWithHtmlCodeAndUnblockTracker">replaceButtonWithHtmlCodeAndUnblockTracker</a></li><li><a href="global.html#replaceButtonWithIframeAndUnblockTracker">replaceButtonWithIframeAndUnblockTracker</a></li><li><a href="global.html#replaceIndividualButton">replaceIndividualButton</a></li><li><a href="global.html#replaceInitialTrackerButtonsHelper">replaceInitialTrackerButtonsHelper</a></li><li><a href="global.html#REPLACEMENT_BUTTONS_FOLDER_PATH">REPLACEMENT_BUTTONS_FOLDER_PATH</a></li><li><a href="global.html#replaceScriptsRecurse">replaceScriptsRecurse</a></li><li><a href="global.html#replaceSubsequentTrackerButtonsHelper">replaceSubsequentTrackerButtonsHelper</a></li><li><a href="global.html#require">require</a></li><li><a href="global.html#revertDomainControl">revertDomainControl</a></li><li><a href="global.html#send_error">send_error</a></li><li><a href="global.html#setTabToUrl">setTabToUrl</a></li><li><a href="global.html#showTrackingDomains">showTrackingDomains</a></li><li><a href="global.html#syncSettings">syncSettings</a></li><li><a href="global.html#syncSettingsDict">syncSettingsDict</a></li><li><a href="global.html#syncUISelections">syncUISelections</a></li><li><a href="global.html#toggleWebRTCIPProtection">toggleWebRTCIPProtection</a></li><li><a href="global.html#trackerInfo">trackerInfo</a></li><li><a href="global.html#unblockTracker">unblockTracker</a></li><li><a href="global.html#updateOrigin">updateOrigin</a></li><li><a href="global.html#updateShowCounter">updateShowCounter</a></li><li><a href="global.html#updateSocialWidgetReplacement">updateSocialWidgetReplacement</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Feb 28 2017 16:09:49 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
